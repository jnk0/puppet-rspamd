<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.13
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-rspamd">rspamd</h1>

<h4 id="label-Table+of+Contents">Table of Contents</h4>
<ol><li>
<p><a href="#label-Description">Description</a></p>
</li><li>
<p><a href="#label-Setup">Setup - The basics of getting started with rspamd</a></p>
<ul><li>
<p><a href="#label-What+rspamd+affects">What rspamd affects</a></p>
</li><li>
<p><a href="#label-Beginning+with+rspamd">Beginning with rspamd</a></p>
</li></ul>
</li><li>
<p><a href="#label-Usage">Usage - Configuration options and additional
functionality</a></p>
</li><li>
<p><a href="#label-Reference">Reference - An under-the-hood peek at what the module
is doing and how</a></p>
</li><li>
<p><a href="#label-Limitations">Limitations - OS compatibility, etc.</a></p>
</li><li>
<p><a href="#label-Development">Development - Guide for contributing to the
module</a></p>
</li></ol>

<h2 id="label-Description">Description</h2>

<p>This module installs and manages the Rspamd spam filter, and provides
resources and functions to configure the Rspamd system. It does, however,
not configure the systems beyond the upstream defaults.</p>

<p>This module is intended to work with Puppet 4.10 and 5 and has been tested
with Rspamd 1.6.3 on Ubuntu 16.04. Patches to support other setups are
welcome.</p>

<h2 id="label-Setup">Setup</h2>

<h3 id="label-What+rspamd+affects">What rspamd affects</h3>

<p>By default, this packageâ€¦</p>
<ul><li>
<p>adds rspamd.com/apt-stable to your APT repository list</p>
</li><li>
<p>installs the rspamd package</p>
</li><li>
<p>recursively purges all custom rspamd config (e.g. local.d and override.d
directories)</p>
</li></ul>

<h3 id="label-Beginning+with+rspamd">Beginning with rspamd</h3>

<p>The simplest way to use this module is:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_rspamd'>rspamd</span>
</code></pre>

<p>This will setup the rspamd service the upstream default configuration.</p>

<h2 id="label-Usage">Usage</h2>

<p>The rspamd::config resource can be used to specify custom configuration
entries. The easiest way to use it, is to put both the file and the
hierachical config key into the resource title:</p>

<pre class="code ruby"><code class="ruby">class { &#39;rspamd&#39;: }
rspamd::config {
  &#39;classifier-bayes:backend&#39;: value =&gt; &#39;redis&#39;;
  &#39;classifier-bayes:servers&#39;: value =&gt; &#39;127.0.0.1:6379&#39;;
  &#39;classifier-bayes:statfile[0].symbol&#39;: value =&gt; &#39;BAYES_HAM&#39;;
  &#39;classifier-bayes:statfile[0].spam&#39;:   value =&gt; false;
  &#39;classifier-bayes:statfile[1].symbol&#39;: value =&gt; &#39;BAYES_SPAM&#39;;
  &#39;classifier-bayes:statfile[1].spam&#39;:   value =&gt; true;
}
</code></pre>

<p>This results the following config file
<code>/etc/rspamd/local.d/classifier-bayes.conf</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># This file is managed by Puppet. DO NOT EDIT.
</span><span class='id identifier rubyid_backend'>backend</span> <span class='op'>=</span> <span class='id identifier rubyid_redis'>redis</span><span class='semicolon'>;</span>
<span class='id identifier rubyid_servers'>servers</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>127.0.0.1:6379</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span>
<span class='id identifier rubyid_statfile'>statfile</span> <span class='lbrace'>{</span>
  <span class='id identifier rubyid_spam'>spam</span> <span class='op'>=</span> <span class='kw'>false</span><span class='semicolon'>;</span>
  <span class='id identifier rubyid_symbol'>symbol</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>BAYES_HAM</span><span class='tstring_end'>&#39;</span></span><span class='semicolon'>;</span>
<span class='rbrace'>}</span>
<span class='id identifier rubyid_statfile'>statfile</span> <span class='lbrace'>{</span>
  <span class='id identifier rubyid_spam'>spam</span> <span class='op'>=</span> <span class='kw'>true</span><span class='semicolon'>;</span>
  <span class='id identifier rubyid_symbol'>symbol</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>BAYES_SPAM</span><span class='tstring_end'>&#39;</span></span><span class='semicolon'>;</span>
<span class='rbrace'>}</span>
</code></pre>

<p>Using the rspamd <code>$config</code> parameter, values for multiple config
files can easily be provided from hiera:</p>

<pre class="code ruby"><code class="ruby">rspamd::config:
  classifier-bayes:
    backend: redis
    servers: &quot;127.0.0.1:6379&quot;
    statfile:
      - symbol: BAYES_HAM
        spam: false
      - symbol: BAYES_SPAM
        spam: true
</code></pre>

<p>This uses the provided <code>rspamd::create_config_resources</code> and
<code>rspamd::create_config_file_resources</code> functions, which can be
used in custom profiles for extended use cases:</p>

<pre class="code ruby"><code class="ruby">class profile::mail::rspamd (
  Hash $config,
  Hash $override_config,
) {
  class { &#39;rspamd&#39;: }

  rspamd::create_config_file_resources($config)
  rspamd::create_config_file_resources($override_config, { mode =&gt; &#39;override&#39; })
}
</code></pre>

<h2 id="label-Reference">Reference</h2>

<p>See the reference generated by puppet strings on <a
href="https://oxc.github.io/puppet-rspamd">oxc.github.io/puppet-rspamd</a>/</p>

<h2 id="label-Limitations">Limitations</h2>

<p>OS Versions tested:</p>
<ul><li>
<p>Ubuntu 16.04</p>
</li></ul>

<p>Rspamd versions tested:</p>
<ul><li>
<p>1.6.3</p>
</li></ul>

<p>Feel free to let me know if it correctly works on a different OS/setup, or
submit patches if it doesn&#39;t.</p>

<h2 id="label-Development">Development</h2>

<p>You&#39;re welcome to submit patches and issues to the issue tracker on
Github.</p>
</div></div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>