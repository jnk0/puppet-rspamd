<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Defined Type: rspamd::config
  
    &mdash; Documentation by YARD 0.9.13
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "puppet_defined_types::rspamd::config";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../puppet_defined_type_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (r)</a> &raquo;
    <span class='title'><span class='object_link'>Defined Types</span></span>
     &raquo; 
    <span class="title">rspamd::config</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="../puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Defined Type: rspamd::config</h1>
<div class="box_info">
  <dl>
    <dt>Defined in:</dt>
    <dd>
      manifests/config.pp
    </dd>
  </dl>
</div>

  <h2>Summary</h2>
  this type manages a single config entry

<h2>Overview</h2>
<div class="docstring">
  <div class="discussion">
    
<h1 id="label-rspamd-3A-3Aconfig">rspamd::config</h1>

<p>Rspamd uses its own UCL (Unified Configuration Language) format. This
format basically allows to define a hierarchy of configuration objects.</p>

<p>Since in puppet, we want to map each single config entry as its own
resource, the hierarchy has been “flattened” to hierarchical keys.</p>

<p>A key/value pair <code>foo = bar</code> nested in a <code>section</code>
object, would look like this in UCL:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_section'>section</span> <span class='lbrace'>{</span>
  <span class='id identifier rubyid_foo'>foo</span> <span class='op'>=</span> <span class='id identifier rubyid_bar'>bar</span>
<span class='rbrace'>}</span>
</code></pre>

<p>To reference this key in a rspam::config variable, you would use the
notation <code>section.foo</code>.</p>

<p>UCL also allows to define arrays, by specifying the same key multiple
times. To map this feature to a flattened key name, we use a numerical
index in brackets. For example, this UCL snippet</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_statfile'>statfile</span> <span class='lbrace'>{</span>
  <span class='id identifier rubyid_token'>token</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BAYES_HAM</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span>
<span class='id identifier rubyid_statfile'>statfile</span> <span class='lbrace'>{</span>
  <span class='id identifier rubyid_token'>token</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BAYES_SPAM</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span>
</code></pre>

<p>would be mapped to</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_statfile'>statfile</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_token'>token</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BAYES_HAM</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_statfile'>statfile</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_token'>token</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BAYES_SPAM</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<h2 id="label-Title-2FName+format">Title/Name format</h2>

<p>This module manages keeps Rspamd&#39;s default configuration untouched, and
manages only local override config files. This matches the procedure
recommended by the Rspamd authors.</p>

<p>To specify which file a config entry should got to, you can use the
<code>file</code> parameter.</p>

<p>For convenience reasons, however, this resource also allows to encode the
values for $sections, $key, and $file into the resource&#39;s name (which
is usally the same as its title).</p>

<p>If the $name of the resource matches the format
“&lt;file&gt;:&lt;sections&gt;.&lt;name&gt;”, and all of $file, $sections,
and $key have not been specified, the values from the name are used. This
simplifies creating unique resources for identical settings in different
files.</p>

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>sections</span>
      
      
        <span class='type'>(<tt>Optional[Array[String]]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>An array of section names that define the hierarchical name of this key.
E.g. <code>[&quot;classifier&quot;, &quot;bayes&quot;] to denote
the</code>classifier “bayes” {` section.</p>

<p>If arrays of values are required (including arrays of maps, i.e. multiple
sections with the same name), the key must be succeeded by an bracketed
index, e.g.</p>

<pre class="code ruby"><code class="ruby">sections =&gt; [&quot;statfile[0]&quot;],
key      =&gt; &quot;token&quot;,
value    =&gt; &quot;BAYES_HAM&quot;,

sections =&gt; [&quot;statifle[1]&quot;],
key      =&gt; &quot;token&quot;,
value    =&gt; &quot;BAYES_SPAM&quot;,
</code></pre>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The key name of the config setting. The key is expected as a single
non-hierachical name without any sections/maps.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>file</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The file to put the value in. This module keeps Rspamd&#39;s default
configuration and makes use of its overrides. The value of this parameter
must not include any path information. If it contains no dot,
<code>.conf</code> will be appended. E.g. <code>bayes-classifier</code></p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Any</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the value of this config entry. See <code>type</code> for allowed types.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>type</span>
      
      
        <span class='type'>(<tt>Rspamd::Ucl::ValueType</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;auto&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The type of the value, can be <code>auto</code>, <code>string</code>,
<code>number</code>, <code>boolean</code>.</p>

<p>The default, <code>auto</code>, will try to determine the type from the
input value: Numbers and strings looking like supported number formats
(e.g. “5”, “5s”, “10min”, “10Gb”, “0xff”, etc.) will be output literally.
Booleans and strings looking like supported boolean formats (e.g. “on”,
“off”, “yes”, “no”, “true”, “false”) will be output literally. Everything
else will be output as a strings, unquoted if possible but quoted if
necessary. Multi-line strings will be output as &lt;&lt;EOD heredocs.</p>

<p>If you require string values that look like numbers or booleans, explicitly
specify type =&gt; &#39;string&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>mode</span>
      
      
        <span class='type'>(<tt>Enum['merge', 'override']</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;merge&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Can be <code>merge</code> or <code>override</code>, and controls whether
the config entry will be written to <code>local.d</code> or
<code>override.d</code> directory.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>comment</span>
      
      
        <span class='type'>(<tt>Optional[String]</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>undef</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>an optional comment that will be written to the config file above the entry</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>ensure</span>
      
      
        <span class='type'>(<tt>Enum['present', 'absent']</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&#39;present&#39;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>whether this entry should be <code>present</code> or <code>absent</code>.
Usually not needed at all, because the config file will be fully managed by
puppet and re-created each time.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Author:</p>
<ul class="author">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>Bernhard Frauendienst <a
href="mailto:puppet@nospam.obeliks.de">puppet@nospam.obeliks.de</a></p>
</div>
      
    </li>
  
</ul>

</div><div class="method_details_list">
  <table class="source_code">
    <tr>
      <td>
        <pre class="lines">


123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170</pre>
      </td>
      <td>
        <pre class="code"><span class="info file"># File 'manifests/config.pp', line 123</span>

define rspamd::config (
  $value,
  Rspamd::Ucl::ValueType $type      = &#39;auto&#39;,
  Enum[&#39;merge&#39;, &#39;override&#39;] $mode   = &#39;merge&#39;,
  Enum[&#39;present&#39;, &#39;absent&#39;] $ensure = &#39;present&#39;,
  Optional[String] $file            = undef,
  Optional[Array[String]] $sections = undef,
  Optional[String] $key             = undef,
  Optional[String] $comment         = undef,
) {
  if (!$key and !$sections and !$file and $name =~ /\A([^:]+):(.+\.)?([^.]+)\z/) {
    $configfile = $1
    $configsections = $2 ? {
      Undef =&gt; [],
      default =&gt; split($2, &#39;\.&#39;),
    }
    $configkey = $3
  } else {
    $configfile = $file
    $configsections = pick($sections, [])
    $configkey = pick($key, $name)
  }
  unless $configfile {
    fail(&quot;Could not detect file name in resource title ${title}, must specify one explicitly&quot;)
  }

  $folder = $mode ? {
    &#39;merge&#39; =&gt; &#39;local.d&#39;,
    &#39;override&#39; =&gt; &#39;override.d&#39;,
  }
  $full_filename = $configfile ? {
    /\./    =&gt; $configfile,
    default =&gt; &quot;${configfile}.conf&quot;,
  }
  $full_file = &quot;${rspamd::config_path}/${folder}/${full_filename}&quot;

  $full_key = join($configsections + $configkey, &#39;/&#39;)
  rspamd::ucl::config { &quot;rspamd config ${full_file} ${full_key}&quot;:
    ensure   =&gt; $ensure,
    file     =&gt; $full_file,
    sections =&gt; $configsections,
    key      =&gt; $configkey,
    value    =&gt; $value,
    type     =&gt; $type,
    comment  =&gt; $comment,
    notify   =&gt; Service[&#39;rspamd&#39;],
  }
}</pre>
      </td>
    </tr>
  </table>
</div>
</div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>